<%- include('../partials/header')%>
<%- include('../partials/navbar')%>

<div class="cart-container">
  <h2><i class="fa fa-shopping-basket me-1" aria-hidden="true"></i>Your Shopping Cart</h2>
  
  <% if (user.cart.length > 0) { %>
    <ul>
      <% let subtotal = 0; %>
      <% user.cart.forEach((item) => { %>
        <% if (item.product) { %> <!-- Only render if product is populated -->
          <li class="cart-item">
            <span class="item-name"><%= item.product.name %></span>
            <span class="item-price">&#x20B9;<%= item.product.price %></span>
            <span class="item-quantity">Quantity: <%= item.added %></span>
            
            <span><form action="/user/<%=item.product._id%>?_method=DELETE" method="POST"><button class="btn btn-warning"><i class="fa fa-minus-square me-1" aria-hidden="true"></i>Take Out</button></form></span>
          </li>
          <% subtotal += item.product.price * item.added; %>
        <% } else { %>
          <li class="cart-item">Product not found</li>
        <% } %>
      <% }); %>
    </ul>
    
    
    
    <div class="cart-summary">
      <p>Subtotal: &#x20B9;<%= subtotal.toFixed(2) %></p>
      <button class="checkout-btn"><i class="fa fa-shopping-cart me-1" aria-hidden="true"></i>Proceed to Checkout</button>
    </div>
  <% } else { %>
    <p>Your cart is empty. Start shopping now!</p>
  <% } %>
</div>

<%- include('../partials/footer')%>
